<!DOCTYPE html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{login-layout}"
>
<head>
  <title>Изменение пароля</title>
</head>


<body>
<!--  Body Wrapper -->
<div class="card-body" layout:fragment="body-login">
  <a th:href="@{/}" class="text-nowrap logo-img text-center d-block py-3 w-100">
    <img src="/assets/images/logos/logo-almaty.png" width="180" alt="logo almaty" />
  </a>
  <p class="text-center">Смена пароля</p>
  <div th:if="${param.notExistUser}" class="alert alert-danger" role="alert">
    Пользователя с таким Email-адресом не существует!
  </div>

  <div th:if="${param.errorChangePassword}" class="alert alert-danger" role="alert">
    Ошибка смены пароля, попробуйте заново!
  </div>

  <form id="formPreload" role="form" method="post" th:action="@{/changePassword}" th:object="${forgotPass}">
    <div class="mb-3">
      <label for="password" class="form-label">Новый пароль</label>
      <p class="position-relative">
        <input
                id="password"
                type="password"
                th:field="*{password}"
                class="form-control mb-3 password"
                aria-describedby="passwordHelp"
                placeholder="Введите новый пароль"
                required
        >
        <i class="ti ti-eye pass-eye togglePassword"></i>
      </p>
      <div class="alert alert-danger mt-3 mb-3"
           th:if="${#fields.hasErrors('password')}"
           th:errors="*{password}"
           role="alert"
      >
      </div>
      <label for="duplicatePassword" class="form-label">Повтор пароля</label>
      <!--                  Spring Security берёт почту, как username, но внутри метода loadUserByUsername поиск производит по Email-->
      <p class="position-relative">
        <input
                id="duplicatePassword"
                type="password"
                th:field="*{duplicatePassword}"
                class="form-control mb-3 password"
                aria-describedby="duplicatePasswordHelp"
                placeholder="Повторите новый пароль"
                required
        >
        <i class="ti ti-eye pass-eye togglePassword"></i>
      </p>
      <div class="alert alert-danger mt-3 mb-3"
           th:if="${#fields.hasErrors('duplicatePassword')}"
           th:errors="*{duplicatePassword}"
           role="alert"
      ></div>
       <div class="alert alert-danger mt-3 mb-3"
           th:if="${#fields.hasGlobalErrors()}"
           role="alert"
      >
         <ul>
           <li th:each="err: ${#fields.globalErrors()}" th:text="${err}"></li>
         </ul>
       </div>
    </div>
<!--    FIXME на всех кнопках post должен быть скрипт с установлением флага disabled,
 чтобыы нельзя была заспамить отправку формы-->
<!--    FIXME добавить капчу для защиты от спама отправки формы-->

    <button
            type="submit"
            id="submitBtn"
            class="btn btn-primary w-100 py-8 fs-4 mb-4 rounded-2"
    >
      <span id="spinner" class="d-none spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      <span id="buttonText">Сменить пароль</span>
    </button>
    <div class="d-flex align-items-center justify-content-center">
      <p class="fs-4 mb-0 fw-bold">Первый раз на сайте?</p>
      <a th:href="@{/register}" class="text-primary fw-bold ms-2">Создайте аккаунт</a>
    </div>

  </form>
</div>


</body>
</html>